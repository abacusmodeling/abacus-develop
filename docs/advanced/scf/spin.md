# Spin-polarization and SOC

## Non-spin-polarized Calculations
Setting of **"nspin 1"** in INPUT file means calculation with non-polarized spin. 
In this case, electrons with spin up and spin down have same occupations at every energy states, weights of bands per k point would be double. 

## Collinear Spin Polarized Calculations
Setting of **"nspin 2"** in INPUT file means calculation with polarized spin along z-axis. 
In this case, electrons with spin up and spin down will be calculated respectively, number of k points would be doubled.
Potential of electron and charge density will separate to spin-up case and spin-down case.

Magnetic moment Settings in [STRU files](../input_files/stru.md) are not ignored until **"nspin 2"** is set in INPUT file

When **"nspin 2"** is set, the screen output file will contain magnetic moment information. e.g.
```
 ITER   TMAG      AMAG      ETOT(eV)       EDIFF(eV)      DRHO       TIME(s)    
 GE1    4.16e+00  4.36e+00  -6.440173e+03  0.000000e+00   6.516e-02  1.973e+01
```
where "TMAG" refers to total magnetization and "AMAG" refers to average magnetization.
For more detailed orbital magnetic moment information, please use [Mulliken charge analysis](../elec_properties/Mulliken.md).

## Noncollinear Spin Polarized Calculations
The spin non-collinear polarization calculation corresponds to setting **"noncolin 1"**, in which case the coupling between spin up and spin down will be taken into account. 
In this case, nspin is automatically set to 4, which is usually not required to be specified manually.
The weight of each band will not change, but the number of occupied states will be double. 
If the nbands parameter is set manually, it is generally set to twice what it would be when nspin<4.

In general, non-collinear magnetic moment settings are often used in calculations considering [SOC effects](#soc-effects). When **"lspinorb 1"** in INPUT file, "nspin" is also automatically set to 4. 
Note: different settings for "noncolin" and "lspinorb" correspond to different calculations:
 - noncolin=0 lspinorb=0 nspin<4 : 
Non-collinear magnetic moments and SOC effects are not considered.
 - noncolin=0 lspinorb=0 nspin=4 : 
Actualy same as the above setting, but the calculation will be larger. So the setting is not recommended.
 - noncolin=1 lspinorb=0 : 
Non-collinear magnetic moments are considered but SOC effects are not considered
 - noncolin=0 lspinorb=1 : 
The SOC effect is considered but the magnetic moment is limited to the Z direction
 - noncolin=1 lspinorb=1 : 
The SOC effect and non-collinear magnetic moment are both calculated.

## For the continuation job
- Continuation job for "nspin 1" need file "SPIN1_CHG" which is generated by setting "out_chg=1" in task before. By setting "init_chg file" in new job's INPUT file, charge density will start from file but not atomic. 
- Continuation job for "nspin 2" need files "SPIN1_CHG" and "SPIN2_CHG" which are generated by "out_chg 1" with "nspin 2", and refer to spin-up and spin-down charge densities respectively. It should be note that reading "SPIN1_CHG" only for the continuation target magnetic moment job is not supported now.
- Continuation job for "nspin 4" need files "SPIN%s_CHG", where %s in {1,2,3,4}, which are generated by "out_chg 1" with any variable setting leading to 'nspin'=4, and refer to charge densities in Pauli spin matrixes. It should be note that reading charge density files printing by 'nspin'=2 case is supported, which means only $\sigma_{tot}$ and $\sigma_{z}$ are read.

# SOC Effects
## SOC 
`lspinorb` is used for control whether or not SOC(spin-orbit coupling) effects should be considered.

Both `basis_type=pw` and `basis_type=lcao` support `scf` and `nscf` calculation with SOC effects.

Atomic forces and cell stresses can not be calculated with SOC effects yet. 

## Pseudopotentials and Numerical Atomic Orbitals
For Norm-Conserving pseudopotentials, there are differences between SOC version and non-SOC version.

Please check your pseudopotential files before calculating.
In `PP_HEADER` part, keyword `has_so=1` and `relativistic="full"` refer to SOC effects have been considered, 
which would lead to different `PP_NONLOCAL` and `PP_PSWFC` parts.
Please be careful that `relativistic="full"` version can be used for SOC or non-SOC calculation, but `relativistic="scalar"` version only can be used for non-SOC calculation.
When full-relativistic pseudopotential is used for non-SOC calculation, ABACUS will automatically transform it to scalar-relativistic version.

Numerical atomic orbitals in ABACUS are unrelated with spin, and same orbital file can be used for SOC and non-SOC calculation.

## Partial-relativistic SOC Effect
Sometimes, for some real materials, both scalar-relativistic and full-relativistic can not describe the exact spin-orbit coupling. 
Artificial modulation can help for these cases.

`soc_lambda`, which has value range [0.0, 1.0] , is used for modulate SOC effect.
In particular, `soc_lambda 0.0` refers to scalar-relativistic case and `soc_lambda 1.0` refers to full-relativistic case.

